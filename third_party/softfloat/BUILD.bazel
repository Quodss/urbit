load("@rules_cc//cc:defs.bzl", "cc_library")
load("@//third_party/softfloat:linux-x86_64.bzl", "linux_x86_64")

# filegroup(
#     name = "srcs",
#     srcs = glob(["**"]),
# )

# make(
#     name = "softfloat",
#     args = ["-C"] + select({
#         "@//:linux-aarch64": ["build/Linux-ARM-VFPv2-GCC"],
#         "@//:linux-x86_64": ["build/Linux-x86_64-GCC"],
#     }),
#     includes = ["source/include"],
#     lib_source = ":srcs",
#     out_static_libs = select({
#         "//conditions:default": ["softfloat.a"],
#     }),
#     visibility = ["//visibility:public"],
# )

DEFINES = select({
    "@//:linux-x86_64": linux_x86_64["defines"],
    "@//:linux-aarch64": linux_x86_64["defines"],
})

INCLUDES = select({
    "@//:linux-x86_64": linux_x86_64["includes"],
    "@//:linux-aarch64": linux_x86_64["includes"],
})

SRCS = select({
    "@//:linux-x86_64": linux_x86_64["srcs"],
    "@//:linux-aarch64": linux_x86_64["srcs"],
})

cc_library(
    name = "softfloat",
    srcs = [
        "source/include/internals.h",
        "source/include/opts-GCC.h",
        "source/include/primitiveTypes.h",
        "source/include/primitives.h",
    ] + SRCS,
    hdrs = [
        "source/include/softfloat.h",
        "source/include/softfloat_types.h",
    ],
    includes = ["source/include"] + INCLUDES,
    local_defines = DEFINES,
    visibility = ["//visibility:public"],
)
