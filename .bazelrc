# See: https://docs.bazel.build/versions/master/user-manual.html#bazelrc.

# https://docs.bazel.build/versions/master/skylark/performance.html#memory-profiling
startup --host_jvm_args=-Xmx2g

# Ignore debug traces, such as when the bazel version differs from what rules expect.
common --ui_event_filters=-DEBUG

# build --incompatible_disallow_empty_glob
# build --compilation_mode=opt
build --color=yes
build --verbose_failures
build --incompatible_strict_action_env
build --java_runtime_version=remotejdk_11
build --tool_java_runtime_version=remotejdk_11

# Pass PATH, CC, CXX and LLVM_CONFIG variables from the environment.
build --action_env=CC --host_action_env=CC
build --action_env=CXX --host_action_env=CXX
build --action_env=LLVM_CONFIG --host_action_env=LLVM_CONFIG
build --action_env=PATH --host_action_env=PATH

# Enable position independent code (this is the default on macOS and Windows)
# (Workaround for https://github.com/bazelbuild/rules_foreign_cc/issues/421)
build:linux --copt=-fPIC

# Optimize build for binary size reduction.
build:sizeopt -c opt --copt -Os

# Allow newly registered toolchains to be resolved (ie. zig cc)
build:zig-cc --incompatible_enable_cc_toolchain_resolution
# build:zig-cc --features=-per_object_debug_info
# build:zig-cc --define force_libcpp=enabled
# build:zig-cc --host_copt=-fno-sanitize=undefined
# build:zig-cc --copt=-fno-sanitize=undefined
# build:zig-cc --extra_toolchains @zig_sdk//toolchain:x86_64-linux-gnu.2.28
build:zig-cc --extra_toolchains @zig_sdk//toolchain:x86_64-linux-musl
build:zig-cc --extra_toolchains @zig_sdk//toolchain:x86_64-macos-gnu
# build:zig-cc --extra_toolchains @zig_sdk//toolchain:aarch64-linux-gnu.2.28
build:zig-cc --extra_toolchains @zig_sdk//toolchain:aarch64-linux-musl
build:zig-cc --extra_toolchains @zig_sdk//toolchain:aarch64-macos-gnu

# Platforms
# build:linux-x86_64 --config=linux
build:linux-x86_64 --config=zig-cc
build:linux-x86_64 --platforms @zig_sdk//platform:linux_x86_64

# build:linux-aarch64 --config=linux
build:linux-aarch64 --config=zig-cc
build:linux-aarch64 --platforms @zig_sdk//platform:linux_aarch64

build:macos-x86_64 --config=zig-cc
build:macos-x86_64 --platforms @zig_sdk//platform:macos_x86_64

build:macos-aarch64 --config=zig-cc
build:macos-aarch64 --platforms @zig_sdk//platform:macos_aarch64

# Any personal configuration settings should go in a gitignored .bazelrc.local
try-import %workspace%/.bazelrc.local
